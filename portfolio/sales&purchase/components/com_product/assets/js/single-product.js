jQuery(function($){$(document).on('click','.addtofavories',function(event){event.preventDefault();var $this=$(this);var count=$this.attr('data-favorites');var request={'product_id':$this.data('id')};$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.favorites',data:request,beforeSend:function(){$this.removeClass('active').find('.fa').removeClass('fa-heart fa-heart-o').addClass('fa-spinner fa-spin');},success:function(response){var data=$.parseJSON(response);if(data.status=='guest'){$('body').addClass('popup-open');$('body').append(data.content);$this.html('<i class="fa fa-heart-o"></i> Add to favorites');$this.removeClass('active');}else if(data.status=='added'){var added=(count*1+ 1);$this.removeAttr('data-favorites').attr('data-favorites',added);$('.favorites-count').text(added);$this.html('<i class="fa fa-heart"></i> Added to favorites');$this.addClass('active');}else if(data.status=='deleted'){var deleted=(count*1- 1);$this.removeAttr('data-favorites').attr('data-favorites',deleted);$('.favorites-count').text(deleted);$this.html('<i class="fa fa-heart-o"></i> Add to favorites');$this.removeClass('active');}}});});$(document).keyup(function(e){if(e.keyCode==27){$('body').removeClass('popup-open');$('.login-popup').remove();}});$(document).on('click','#close-login',function(event){event.preventDefault();$('body').removeClass('popup-open');$('.login-popup').remove();});$(document).ready(function(){$('.pagination').find('>li:not(.disabled)>a').each(function(){if(getParameterByName('limitstart',$(this).attr('href'))){$(this).attr('href','?limitstart='+ getParameterByName('limitstart',$(this).attr('href'))+'#comments');}
if(getParameterByName('start',$(this).attr('href'))){$(this).attr('href','?start='+ getParameterByName('start',$(this).attr('href'))+'#comments');}});});function getParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+ name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);if(!results)return null;if(!results[2])return'';return decodeURIComponent(results[2].replace(/\+/g," "));}
$('#action-item-details').on('click',function(event){event.preventDefault();var actions=$(this).closest('ul').find('>li');actions.removeClass('active');$(this).parent().addClass('active');window.history.replaceState("","",$(this).attr('href'));$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.product_details&product_id='+ $(this).data('product_id')+'&format=json',beforeSend:function(){$('.item-content-inner').addClass('loading').prepend($('<div class="preloader"><div></div></div>'));},success:function(response){var data=$.parseJSON(response);$('.item-content-inner').empty().removeClass('loading');$('.item-content-inner').html(data.content);}});});$('#action-item-comments').on('click',function(event){event.preventDefault();var actions=$(this).closest('ul').find('>li');actions.removeClass('active');$(this).parent().addClass('active');window.history.replaceState("","",$(this).attr('href'));$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.comments_list&product_id='+ $(this).data('product_id')+'&format=json',beforeSend:function(){$('.item-content-inner').addClass('loading').prepend($('<div class="preloader"><div></div></div>'));},success:function(response){var data=$.parseJSON(response);var public_key=data.public_key;$('.item-content-inner').empty().removeClass('loading');$('.item-content-inner').html(data.content);if(data.recaptcha){grecaptcha.render("dynamic_recaptcha",{sitekey:'"'+ data.public_key+'"',theme:"light"});}
$('.pagination>li:not(.disabled)>a').each(function(){if(getParameterByName('limitstart',$(this).attr('href'))){$(this).attr('href','?limitstart='+ getParameterByName('limitstart',$(this).attr('href'))+'#comments');}
if(getParameterByName('start',$(this).attr('href'))){$(this).attr('href','?start='+ getParameterByName('start',$(this).attr('href'))+'#comments');}});}});});$('#action-item-reviews').on('click',function(event){event.preventDefault();var actions=$(this).closest('ul').find('>li');actions.removeClass('active');$(this).parent().addClass('active');window.history.replaceState("","",$(this).attr('href'));$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.reviews&product_id='+ $(this).data('product_id')+'&format=json',beforeSend:function(){$('.item-content-inner').addClass('loading').prepend($('<div class="preloader"><div></div></div>'));},success:function(response){var data=$.parseJSON(response);$('.item-content-inner').empty().removeClass('loading');$('.item-content-inner').html(data.content);}});});$(document).on('submit','#comment-form',function(event){event.preventDefault();var $this=$(this);var request={'text':$('#comment_text').val(),'product_id':$('.item-details').data('id'),'g-recaptcha-response':$('#g-recaptcha-response').val()};$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.add_comment&format=json',data:request,beforeSend:function(){$('.comment-form-wrapper').addClass('loading');},success:function(response){var data=$.parseJSON(response);if(data.status){$('#comments .alert-warning').remove();$(data.content).appendTo($('#comments')).hide().fadeIn();$('#comment_text').val('');$('.comment-form-wrapper').removeClass('loading');$('.comment-status').removeClass('alert alert-danger').addClass('alert alert-success').text(data.message);setTimeout(function(){$('.comment-status').html('').removeClass('alert alert-success');},1500);var request_alt={'product_id':data.product_id,'comment_id':data.comment_id};$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.comment_notification',data:request_alt});}else{$('.comment-form-wrapper').removeClass('loading');$('.comment-status').removeClass('alert alert-success').addClass('alert alert-danger').text(data.message);}
if(data.recaptcha){grecaptcha.reset();}else{$('#dynamic_recaptcha').parent().remove();}}});return false;});$(document).on('click','.remove-comment',function(event){event.preventDefault();var $this=$(this);if(confirm('Are you sure to remove this comment?')){var request={'comment_id':$this.data('comment_id')};$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.remove_comment',data:request,success:function(response){if(response){$this.closest('.comment').animate({height:0,opacity:0},300,function(event){$(this).remove();});}else{alert('Something went wrong!');}}});}});$(document).on('click','.btn-comment-reply',function(event){event.preventDefault();$('#reply-form').remove();var $this=$(this);var product_id=$this.closest('.comment').attr('id').split('-');var form_html='<form action="" id="reply-form">';form_html+='<div class="form-group">';form_html+='<textarea name="reply_text" id="reply_text" class="form-control" minlength="2" required="required" placeholder="Reply Comment"></textarea>';form_html+='</div>';form_html+='<input type="hidden" id="reply_product_id" name="reply_product_id" value="'+ product_id[0]+'">';form_html+='<input type="hidden" id="reply_parent_id" name="reply_parent_id" value="'+ product_id[1]+'">';form_html+='<button class="btn btn-success" type="submit">Submit</button> <a href="#" id="cancel-reply" class="btn btn-danger">Cancel</a>';form_html+='</form>';$(form_html).appendTo($this.closest('.media-body'));$('#reply_text').focus();});$(document).on('click','#cancel-reply',function(event){event.preventDefault();$('#reply-form').remove();});$(document).on('submit','#reply-form',function(event){event.preventDefault();var $this=$(this);var request={'reply_text':$('#reply_text').val(),'reply_product_id':$('#reply_product_id').val(),'reply_parent_id':$('#reply_parent_id').val()};$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.add_reply',data:request,success:function(response){var data=$.parseJSON(response);if(data.status){$(data.content).appendTo($this.closest('.comment').find('.comment-replies'));$('#reply_text').val('');var request_alt={'product_id':data.product_id,'comment_id':data.comment_id};$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.reply_notification',data:request_alt});}else{alert('Oops, Something went wrong.');}}});});$(document).on('keyup','textarea',function(){adaptiveheight(this);});function adaptiveheight(a){var i=0;var j=0;$(a).height(0);var scrollval=$(a)[0].scrollHeight;$(a).height(scrollval);if(parseInt(a.style.height)>$(window).height()){if(j==0){max=a.selectionEnd;}
j++;var i=a.selectionEnd;console.log(i);if(i>=max){$(document).scrollTop(parseInt(a.style.height));}else{$(document).scrollTop(0);}}}
$(document).on('click','.remove-reply',function(event){event.preventDefault();var $this=$(this);var request={'comment_id':$this.data('reply_id')};if(confirm('Are you sure to remove this reply?')){$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.remove_reply',data:request,success:function(response){if(response){$this.closest('.comment-reply').fadeOut(300,function(){$(this).remove()});}}});}});$(document).on('click','.report-reply',function(event){event.preventDefault();var $this=$(this);$('#report-reply-outer').remove();var form_html='<div id="report-reply-outer"><p class="text-danger">If you find this reply offensive to you, please submit a report here.</p>';form_html+='<form action="" id="report-form">';form_html+='<div class="form-group">';form_html+='<textarea name="report_text" id="report_text" class="form-control" minlength="2" required="required"></textarea>';form_html+='</div>';form_html+='<input type="hidden" name="reply_id" id="reply_id" value="'+ $this.data('reply_id')+'">';form_html+='<button class="btn btn-warning" type="submit">Report</button> <a href="#" id="cancel-report" class="btn btn-link">Cancel</a>';form_html+='</form></div>';$(form_html).appendTo($this.closest('.media-body'));$('#report_text').focus();});$(document).on('click','#cancel-report',function(event){event.preventDefault();$('#report-reply-outer').remove();});$(document).on('submit','#report-form',function(event){event.preventDefault();var $this=$(this);var data=$(this).serializeArray();var request={'comment_text':$this.closest('.comment-reply').find('.comment-text').text(),'data':data};$.ajax({type:'POST',url:product_url+'index.htm?option=com_product&task=products.report_comment',data:request,success:function(response){$('#report-reply-outer').remove();alert('Your report have been submitted to the site administrator');}});});});